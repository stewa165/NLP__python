# -*- coding: utf-8 -*-
"""Summarization 0.1.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1WNOrsqmCILG2HejSegvRsb5ZblPs1FI1

Initialize
"""

#!pip install beautifulsoup4
#!pip install lxml
#import bs4 as bs
#import urllib.request
import re
import nltk
nltk.download('punkt')

"""Scrape for Article Text (BeautifulSoup)"""

#scraped_data = urllib.request.urlopen('https://www.reuters.com/article/us-johnson-johnson-talc-ruling/johnson-johnson-fails-to-overturn-2-12-billion-baby-powder-verdict-plans-supreme-court-appeal-idUSKBN27J2N4')
#article = scraped_data.read()

#parsed_article = bs.BeautifulSoup(article,'lxml')

#paragraphs = parsed_article.find_all('p')

#article_text = ""

#for p in paragraphs:
#    article_text += p.text

#print(article_text)

"""Example text document - Johnson&Johnson"""

article_text = '''Drugmaker Johnson & Johnson is asking the Supreme Court to review a $2.11 billion jury verdict from Missouri over baby powder it produced that allegedly contained asbestos that caused ovarian cancer. In addition to a vaccine used against the CCP virus, which causes the disease COVID-19, the 135-year-old New Jersey-based company has been known for making a variety of talc-based consumer products such as its iconic baby powder, which is the subject of the litigation. The petition in the case, known as Johnson & Johnson v. Ingham, court file 20-1223, was filed with the Supreme Court on March 4. The verdict came out of a 2018 trial that consolidated the claims of 22 women who alleged the company’s talc powder caused their ovarian cancer. After a six-week trial, a St. Louis jury originally ordered the company to pay $4.69 billion, but in 2020, the Missouri Court
of Appeals lowered the sum to $2.11 billion, trade publication Fierce Pharma reported at the time. Also last year, the company stopped selling talc powders in the United States. That court found that the plaintiffs “proved with convincing clarity” that Johnson & Johnson “engaged in outrageous conduct because of an evil motive or reckless indifference.” Company officials, according to the court, “discussed the presence of asbestos in their talc in internal memoranda for several decades; avoided adopting more accurate measures for detecting asbestos and influenced the industry to do the same; attempted to discredit those scientists publishing studies unfavorable to their products; and did not eliminate talc from the products and use cornstarch instead because it would be more costly to do so.” Johnson & Johnson argues that bad science was relied on during the trial and that the company was denied due process. The trial was “fundamentally flawed,” and “numerous legal errors allowed a faulty presentation of the facts, resulting in an incorrect verdict and arbitrary and disproportionate damages,” the company said in a statement supplied by its attorneys. The verdict is “at odds with decades of independent scientific evaluations confirming Johnson’s Baby Powder is safe, is not contaminated by asbestos and does not cause cancer.” The $2.1 billion award in the case “is so unmoored from any notion of proportionality or malice that reversal is warranted based solely on the arbitrary size of the jury’s damages award,” Cory L. Andrews, general counsel and vice president of litigation for the Washington Legal Foundation, said in a statement. “The legal inconsistencies in this case highlight some of the worst abuses in our civil justice system today,” Tiger Joyce, president of the American Tort Reform Association, said in a statement. “The City of St. Louis is regularly named among the worst ‘Judicial Hellholes’ in the country and it’s no wonder. The court allowed nearly two dozen plaintiffs from different states who all had varying circumstances to be joined together in a friendly venue of their lawyers’ choosing. The trial lawyers then presented questionable scientific evidence as though it were fact, unfairly prejudicing the jury in the process.” Johnson & Johnson argues in its petition that it has been victimized by plaintiffs’ lawyers, who have abused the legal system. “Today, confusion reigns in the lower courts over the due process boundaries of mass trials—and whether jury instructions by themselves are a sufficient antidote to the jury confusion and prejudice mass trials cause. The Court should intervene here to curb due-process abuses in mass-tort suits and ensure that state courts give mass-tort defendants the same rights as everyone else.” The company reiterates that its talc products are safe for consumer use. Federal regulators and
respected health organizations reject calls for warnings on talc and “comprehensive epidemiological studies tracking tens of thousands of talc users have found no meaningful association between cosmetic talc use and ovarian cancer.” The Food and Drug Administration, National Cancer Institute, and American Cancer Society have all reached the same conclusion, the company states. “Yet some plaintiffs’ lawyers have struck on a winning formula: They first canvass the country for women who were both diagnosed with ovarian cancer and among the millions who used Petitioners’ talc products. They then select a jurisdiction where out-of-state plaintiffs can be consolidated with in-state plaintiffs for a single mass trial. They put dozens of plaintiffs on the stand to discuss their experiences with cancer, and the jury awards billions of dollars in punitive damages supposedly to punish Petitioners. “Lawyers can then follow this script and file the same claims with new plaintiffs and seek new outsized awards, over and over again.” It’s unclear when the Supreme Court will rule on whether to hear the company’s appeal. Thomas C. Goldstein, counsel of record for the consumers suing Johnson & Johnson, declined to comment to The Epoch Times on the pending litigation.'''

"""Pre-processing"""

# Removing Square Brackets and Extra Spaces
article_text = re.sub(r'\[[0-9]*\]', ' ', article_text)
article_text = re.sub(r'\s+', ' ', article_text)

# Removing special characters and digits
formatted_article_text = re.sub('[^a-zA-Z]', ' ', article_text )
formatted_article_text = re.sub(r'\s+', ' ', formatted_article_text)

"""Convert Text to Sentences"""

sentence_list = nltk.sent_tokenize(article_text)

sentence_list

"""Find Weighted Frequencies"""

nltk.download('stopwords')
stopwords = nltk.corpus.stopwords.words('english')

word_frequencies = {}
for word in nltk.word_tokenize(formatted_article_text):
    if word not in stopwords:
        if word not in word_frequencies.keys():
            word_frequencies[word] = 1
        else:
          word_frequencies[word] += 1

maximum_frequncy = max(word_frequencies.values())

for word in word_frequencies.keys():
    word_frequencies[word] = (word_frequencies[word]/maximum_frequncy)

word_frequencies.keys()

word_frequencies.values()

"""Calculate Sentence Score"""

sentence_scores = {}
for sent in sentence_list:
    for word in nltk.word_tokenize(sent.lower()):
        if word in word_frequencies.keys():
            if len(sent.split(' ')) < 30:
                if sent not in sentence_scores.keys():
                    sentence_scores[sent] = word_frequencies[word]
                else:
                    sentence_scores[sent] += word_frequencies[word]

sentence_scores

"""Get Summary"""

import heapq
summary_sentences = heapq.nlargest(3, sentence_scores, key=sentence_scores.get)
summary = ' '.join(summary_sentences)
print(summary)
#with open('summary.txt', mode='w') as file_object:
#    print(summary, file=file_object)

# Select article text for summarization
article_text = []  
#for ahits in article_hitlist:
#  print("article: ", ahits)
for ahits in article_hitlist:
  #print("article: ", ahits)
  article_text.append(ahits[1][0][3])

###############################
# Convert Text to Sentences
for article in article_text:
  #print(article)
  sentence_list = nltk.sent_tokenize(article)
  #print(sentence_list)

  #############################
  # Find Weighted Frequencies
  #nltk.download('stopwords')
  #stopwords = nltk.corpus.stopwords.words('english')

  word_frequencies = {}
  for word in nltk.word_tokenize(str(article)):
      if word not in stopwords:
          if word not in word_frequencies.keys():
              word_frequencies[word] = 1
          else:
              word_frequencies[word] += 1
  maximum_frequncy = max(word_frequencies.values())

  for word in word_frequencies.keys():
      word_frequencies[word] = (word_frequencies[word]/maximum_frequncy)

  ###########################
  # Calculate Sentence Score
  sentence_scores = {}
  for sent in sentence_list:
      for word in nltk.word_tokenize(sent.lower()):
          if word in word_frequencies.keys():
              if len(sent.split(' ')) < 30:
                  if sent not in sentence_scores.keys():
                      sentence_scores[sent] = word_frequencies[word]
                  else:
                      sentence_scores[sent] += word_frequencies[word]
    
  ############################
  # Get Summaries (3 sentences and 7 sentences)
  summary_sentences_three = heapq.nlargest(3, sentence_scores, key=sentence_scores.get)
  summary_three = ' '.join(summary_sentences_three)
  #print(summary_three)
 
 
 
  summary_sentences_seven = heapq.nlargest(7, sentence_scores, key=sentence_scores.get)
  summary_seven = ' '.join(summary_sentences_seven)
  #print(summary_seven)

  #article_hitlist.append([summary_three]) #, summary_seven])
  #for article in article_hitlist:
  #  print(article)

# Select article text for summarization
article_text = []  
#for ahits in article_hitlist:
#  print("article: ", ahits)
for ahits in article_hitlist:
  #print("article: ", ahits)
  article_text.append(ahits[1][0][3])

def get_summary(article, no_sent):